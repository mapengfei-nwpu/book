# **MPI并行程序设计实例教程**

 ## 1 并行编程模式

- 隐式并行
- 数据并行
- **消息传递**（被MPI采用）
  - 进程只有本地内存空间
  - 进程之间通过发送接收消息进行通信
  - 进程之间需要使用协同操作完成数据传递
  - 发送操作必须要求有与之配对的接受操作
  - 缺点：要求在编程过程中参与显示的数据划分和进程之间同步，因此会在解决数据依赖，预防死锁等问题上花费较大精力
- 共享变量 

### 2 MPI程序工作模式

显式区分：程序设计阶段通过显式的条件判断来指定不同进程上运行的代码块。

```c
switch (rank) {
    case processor1:
        // code block processed by processor1.
        break;
    case processor2:
        //
        break;
    // ..
    default:
        // code block processed by all processors.
}
```

MPI程序特点：每个进程上的程序是一摸一样的，但是运行时进程编号不同，程序的行为也不同。进程间程序中的所有变量都是进程私有的，必须通过消息传递函数进行交互。

### 3 MPI消息传递通信的基本概念

1. 信封和信

   一个消息能发送成功需要信封和信纸。消息封装在一个**信封**里。

   信封由三个要素构成：发送者、接收者、通讯子。通信器相当于声明了信封所处的邮政系统，比如中国邮政。默认通讯子是**MPI_COMM_WORLD**，每个进程上都有一个这样的变量，它记录所有兄弟进程的地址信息。

   邮戳：

   消息作为新建内容由一个三元组标记：<缓冲区、网络传输层、分块传输>。

2. 缓冲区

   MPI环境中定义了三种缓冲区：应用缓冲区、系统缓冲区、用户向系统注册的(通信用)缓冲区。

   应用缓冲区：保存将要发送的或接受的数据的地址空间

   系统缓冲区：MPI环境为通信所准备的空间

   用户向系统注册的缓冲区：程序中显式申请的存储空间

   缓冲区是导致死锁的重要原因，不用缓冲区机制也可正常工作的程序是最安全的，确保了最大限度的可移植性。

3. 通信子communicator

   对某个进程的操作必须放入某个通信子内方有效。不同通信子之间的消息互不干扰。

4. 进程号和进程组

   进程号(rank)：在一个通信子内，每一个进程都被分配了一个进程号。

5. 通信协议

   1. 立即通信协议：假定目标进程具有保存消息数据的能力，缓存在发送者。
   2. 集中通信协议：在目标准备好后才执行发送数据。先发送信封，等到接受进程的许可，立即执行发送动作。
   3. 短消息通信协议：消息数据和信封封装在一起发送，可用立即通讯协议代替。

6. 隐形对象

   MPI系统保留的变量，对用户不可见。

   





















消息处理接口：message process interface，是一个标准，不同厂商由不同版本的实现：MPICH、LAMMPI、IBM MPL 下载、解压、编译、测试。 进程管理器：MPD，用于MPI进程的创建启动和管理。 目标主机列表：$HOME/mpd.hosts文件中指定。 节点间无密码登陆：

通讯子（communicator）：也称为通讯器 秩（rank）：每个进程被分配的一个序号，用于显式地进行通信。 消息标签（tag）： 点对点通信（point-to-point）： 集体性通信（collective）：